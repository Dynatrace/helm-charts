suite: test deployment for dynatrace operator
templates:
  - Common/deployment-operator.yaml
tests:
  - it: should exist
    set:
      operator.image: image-name
    asserts:
      - isKind:
          of: Deployment
      - equal:
          path: metadata.name
          value: RELEASE-NAME
      - equal:
          path: metadata.namespace
          value: NAMESPACE
      - isNotEmpty:
          path: metadata.labels
      - equal:
          path: spec.replicas
          value: 1
      - equal:
          path: spec.selector
          value:
            matchLabels:
                name: RELEASE-NAME
      - isNotEmpty:
          path: spec.template.metadata.labels
      - equal:
          path: spec.template.spec
          value:
            serviceAccountName: RELEASE-NAME
            containers:
              - name: RELEASE-NAME
                # Replace this with the built image name
                image: image-name
                command:
                  - dynatrace-operator
                imagePullPolicy: Always
                env:
                  - name: POD_NAMESPACE
                    valueFrom:
                      fieldRef:
                        fieldPath: metadata.namespace
                  - name: POD_NAME
                    valueFrom:
                      fieldRef:
                        fieldPath: metadata.name
                resources:
                  requests:
                    cpu: 50m
                    memory: 64Mi
                  limits:
                    cpu: 100m
                    memory: 256Mi
