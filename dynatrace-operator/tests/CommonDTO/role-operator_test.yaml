suite: test role for dynatrace operator
templates:
  - CommonDTO/role-operator.yaml
tests:
  - it: should exist
    asserts:
      - isKind:
          of: Role
      - equal:
          path: metadata.name
          value: RELEASE-NAME
      - equal:
          path: metadata.namespace
          value: NAMESPACE
      - isNotEmpty:
          path: metadata.labels
      - contains:
          path: rules
          content:
            apiGroups:
            - dynatrace.com
            resources:
              - dynakubes
            verbs:
              - get
              - list
              - watch
              - update
              - create
      - contains:
          path: rules
          content:
            apiGroups:
              - dynatrace.com
            resources:
              - dynakubes/finalizers
              - dynakubes/status
            verbs:
              - update
      - contains:
          path: rules
          content:
            apiGroups:
              - apps
            resources:
              - statefulsets
            verbs:
              - get
              - list
              - watch
              - create
              - update
              - delete
      - contains:
          path: rules
          content:
            apiGroups:
              - apps
            resources:
              - replicasets
              - deployments
            verbs:
              - get
              - list
              - watch
      - contains:
          path: rules
          content:
            apiGroups:
              - apps
            resources:
              - deployments/finalizers
            verbs:
              - update
      - contains:
          path: rules
          content:
            apiGroups:
              - ""
            resources:
              - configmaps
            verbs:
              - get
              - list
              - watch
              - create
              - update
              - delete
      - contains:
          path: rules
          content:
            apiGroups:
              - ""
            resources:
              - pods
            verbs:
              - get
              - list
              - watch
              - delete
              - create
      - contains:
          path: rules
          content:
            apiGroups:
              - ""
            resources:
              - secrets
            verbs:
              - get
              - list
              - watch
              - create
              - update
      - contains:
          path: rules
          content:
            apiGroups:
              - ""
            resources:
              - services
            verbs:
              - create
              - get
      - contains:
          path: rules
          content:
            apiGroups:
              - ""
            resources:
              - events
            verbs:
              - list
              - create
      - contains:
          path: rules
          content:
            apiGroups:
              - policy
            resources:
              - podsecuritypolicies
            resourceNames:
              - dynatrace-operator
            verbs:
              - use
      - contains:
          path: rules
          content:
            apiGroups:
              - monitoring.coreos.com
            resources:
              - servicemonitors
            verbs:
              - get
              - create
